---
const pathname = Astro.url.pathname;
const base = import.meta.env.BASE_URL;

// A little helper to handle the homepage path correctly, which sometimes has a trailing slash
const homePath = base.endsWith("/") ? base : base + "/";
---

<div x-data="{ isOpen: false }" @keydown.escape.window="isOpen = false" class="relative">
<header
  class="relative z-[102] bg-gradient-to-r from-[#36454F] via-[#3D4E5A] to-[#36454F] shadow-lg"
  style="box-shadow: 0 4px 20px rgba(192, 178, 131, 0.15), inset 0 -1px 0 rgba(192, 178, 131, 0.3);"
>
  <div class="container mx-auto px-6 py-4">
    <div class="flex flex-wrap items-center justify-between">
      <a href="/" class="flex items-center gap-3 group">
        <img
          src="/logo.png"
          alt="SomaRenew Medical Logo"
          class="h-12 w-auto transition-transform duration-300 group-hover:scale-105"
        />
      </a>

      <nav class="hidden lg:flex items-center gap-6 xl:gap-8">
        <a
          class="text-sm xl:text-base font-medium text-white/90 hover:text-[var(--soma-gold)] transition-colors duration-300"
          href="/">Home</a
        >
        <a
          class="text-sm xl:text-base font-medium text-white/90 hover:text-[var(--soma-gold)] transition-colors duration-300"
          href="/aboutus">About Us</a
        >
        <a
          class="text-sm xl:text-base font-medium text-white/90 hover:text-[var(--soma-gold)] transition-colors duration-300"
          href="/services">Services</a
        >
        <a
          class="text-sm xl:text-base font-medium text-white/90 hover:text-[var(--soma-gold)] transition-colors duration-300 whitespace-nowrap"
          href="/patientjourney">The Patient Journey</a
        >
        <a
          class="text-sm xl:text-base font-medium text-white/90 hover:text-[var(--soma-gold)] transition-colors duration-300"
          href="/contact">Contact Us</a
        >
      </nav>
      <div class="hidden lg:flex items-center gap-2 xl:gap-3">
        <a
          class="inline-flex items-center gap-2 rounded-full border border-[var(--soma-gold)]/50 px-4 xl:px-5 py-2 xl:py-2.5 text-sm font-medium text-[var(--soma-gold)] transition-all duration-300 hover:bg-[var(--soma-gold)]/10 hover:border-[var(--soma-gold)]"
          href="https://partner.pabau.com/soma-renew-medical/login"
          target="_blank"
          rel="noopener noreferrer"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
            ></path>
          </svg>
          Patient Portal
        </a>
        <a
          class="inline-flex items-center gap-2 rounded-full bg-[var(--soma-gold)] px-5 xl:px-7 py-2.5 xl:py-3 text-sm xl:text-base font-semibold text-[var(--charcoal)] transition-all duration-300 hover:bg-[#D4C89A] hover:scale-105 shadow-md whitespace-nowrap"
          href="/consultation"
        >
          Schedule Consultation
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg
          >
        </a>
      </div>

      <!-- Animated Hamburger Button -->
      <button
        @click="isOpen = !isOpen"
        class="lg:hidden p-3 rounded-xl text-white hover:bg-[var(--soma-gold)]/20 hover:text-[var(--soma-gold)] transition-colors relative w-12 h-12 flex items-center justify-center"
        :class="{ 'bg-[var(--soma-gold)]/20 text-[var(--soma-gold)]': isOpen }"
        aria-label="Toggle mobile menu"
      >
        <div class="hamburger-icon w-6 h-5 relative flex flex-col justify-between" :class="{ 'is-open': isOpen }">
          <span class="hamburger-line block h-0.5 w-full bg-current rounded-full transition-all duration-300 origin-center"></span>
          <span class="hamburger-line block h-0.5 w-full bg-current rounded-full transition-all duration-300"></span>
          <span class="hamburger-line block h-0.5 w-full bg-current rounded-full transition-all duration-300 origin-center"></span>
        </div>
      </button>
    </div>
  </div>
</header>

<!-- Mobile Menu Backdrop - Separate for proper animation -->
<div
  x-show="isOpen"
  x-cloak
  class="fixed inset-0 z-[100] lg:hidden bg-charcoal/40"
  @click="isOpen = false"
  @touchstart="isOpen = false"
  x-transition:enter="transition ease-out duration-300"
  x-transition:enter-start="opacity-0"
  x-transition:enter-end="opacity-100"
  x-transition:leave="transition ease-in duration-200"
  x-transition:leave-start="opacity-100"
  x-transition:leave-end="opacity-0"
></div>

<!-- Mobile Menu Panel - Slides down from header -->
<nav
  x-show="isOpen"
  x-cloak
  class="fixed inset-x-0 z-[101] lg:hidden w-full max-w-md mx-auto px-4"
  style="top: calc(env(safe-area-inset-top, 0px) + 120px);"
  x-transition:enter="transition ease-out duration-500"
  x-transition:enter-start="opacity-0 -translate-y-8"
  x-transition:enter-end="opacity-100 translate-y-0"
  x-transition:leave="transition ease-in duration-300"
  x-transition:leave-start="opacity-100 translate-y-0"
  x-transition:leave-end="opacity-0 -translate-y-8"
>
    <div
      class="mobile-glass-menu relative flex flex-col items-center gap-4 py-10 rounded-3xl overflow-hidden"
    >
      <a
        class:list={[
          "font-serif text-2xl py-4 min-h-[56px] flex items-center transition-all duration-300 tracking-wide",
          {
            "text-[var(--soma-gold)]":
              pathname === base || pathname === homePath,
            "text-white/90 hover:text-[var(--soma-gold)]": !(
              pathname === base || pathname === homePath
            ),
          },
        ]}
        href="/">Home</a
      >
      <a
        class:list={[
          "font-serif text-2xl py-4 min-h-[56px] flex items-center transition-all duration-300 tracking-wide",
          {
            "text-[var(--soma-gold)]": pathname.startsWith(`${base}/aboutus`),
            "text-white/90 hover:text-[var(--soma-gold)]":
              !pathname.startsWith(`${base}/aboutus`),
          },
        ]}
        href="/aboutus">About Us</a
      >
      <a
        class:list={[
          "font-serif text-2xl py-4 min-h-[56px] flex items-center transition-all duration-300 tracking-wide",
          {
            "text-[var(--soma-gold)]": pathname.startsWith(
              `${base}/services`,
            ),
            "text-white/90 hover:text-[var(--soma-gold)]":
              !pathname.startsWith(`${base}/services`),
          },
        ]}
        href="/services">Services</a
      >
      <a
        class:list={[
          "font-serif text-2xl py-4 min-h-[56px] flex items-center transition-all duration-300 tracking-wide",
          {
            "text-[var(--soma-gold)]": pathname.startsWith(
              `${base}/patientjourney`,
            ),
            "text-white/90 hover:text-[var(--soma-gold)]":
              !pathname.startsWith(`${base}/patientjourney`),
          },
        ]}
        href="/patientjourney">The Patient Journey</a
      >
      <a
        class:list={[
          "font-serif text-2xl py-4 min-h-[56px] flex items-center transition-all duration-300 tracking-wide",
          {
            "text-[var(--soma-gold)]": pathname.startsWith(`${base}/contact`),
            "text-white/90 hover:text-[var(--soma-gold)]":
              !pathname.startsWith(`${base}/contact`),
          },
        ]}
        href="/contact">Contact Us</a
      >
      <div class="flex flex-col items-center gap-4 mt-6 w-full px-6">
        <a
          class="w-full max-w-xs rounded-full border border-white/30 px-6 py-3.5 min-h-[48px] text-center font-medium text-white transition-all duration-300 hover:border-white/60 hover:bg-white/10"
          href="https://partner.pabau.com/soma-renew-medical/login"
          target="_blank"
          rel="noopener noreferrer"
        >
          Patient Portal
        </a>
        <a
          class="w-full max-w-xs rounded-full bg-[var(--soma-gold)] px-6 py-3.5 min-h-[48px] text-center font-semibold text-[var(--charcoal)] transition-all duration-300 hover:bg-[#D4C89A] shadow-[0_0_15px_rgba(192,178,131,0.3)]"
          href="/consultation"
        >
          Schedule Consultation
        </a>
      </div>
    </div>
</nav>
</div>

<style>
  /* Animated Hamburger Icon â†’ X Transformation */
  .hamburger-icon .hamburger-line:nth-child(1) {
    transform: translateY(0) rotate(0);
  }
  .hamburger-icon .hamburger-line:nth-child(2) {
    opacity: 1;
    transform: scaleX(1);
  }
  .hamburger-icon .hamburger-line:nth-child(3) {
    transform: translateY(0) rotate(0);
  }
  
  /* Open state - Transform to X */
  .hamburger-icon.is-open .hamburger-line:nth-child(1) {
    transform: translateY(8px) rotate(45deg);
  }
  .hamburger-icon.is-open .hamburger-line:nth-child(2) {
    opacity: 0;
    transform: scaleX(0);
  }
  .hamburger-icon.is-open .hamburger-line:nth-child(3) {
    transform: translateY(-8px) rotate(-45deg);
  }

  /* Premium Glassmorphism Mobile Menu - True Floating Glass Panel */
  .mobile-glass-menu {
    background: linear-gradient(
      135deg,
      rgba(54, 69, 79, 0.45) 0%,
      rgba(48, 60, 70, 0.40) 50%,
      rgba(42, 54, 62, 0.50) 100%
    );
    backdrop-filter: blur(40px) saturate(1.5);
    -webkit-backdrop-filter: blur(40px) saturate(1.5);
    border: 1px solid rgba(192, 178, 131, 0.35);
    box-shadow: 
      0 32px 64px -16px rgba(0, 0, 0, 0.6),
      0 16px 32px -8px rgba(0, 0, 0, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.15),
      inset 0 -1px 0 rgba(0, 0, 0, 0.25),
      0 0 0 1px rgba(192, 178, 131, 0.2);
  }

  /* Subtle top gold highlight line */
  .mobile-glass-menu::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(
      90deg,
      transparent 0%,
      rgba(192, 178, 131, 0.6) 20%,
      rgba(255, 255, 255, 0.3) 50%,
      rgba(192, 178, 131, 0.6) 80%,
      transparent 100%
    );
    z-index: 10;
  }

  /* Ambient glow effect behind menu */
  .mobile-glass-menu::after {
    content: '';
    position: absolute;
    inset: -8px;
    background: linear-gradient(
      135deg,
      rgba(192, 178, 131, 0.15) 0%,
      transparent 40%,
      transparent 60%,
      rgba(192, 178, 131, 0.1) 100%
    );
    border-radius: inherit;
    z-index: -1;
    filter: blur(24px);
    opacity: 0.9;
  }
</style>
